

    {% extends 'base.html' %}
{% block title %}Your Profile{% endblock %}
{% block content %}
<h2>Authenticated User</h2>
<ul>
    <li><strong>Auth0 sub:</strong> {{ auth.sub }}</li>
    <li><strong>Email:</strong> {{ auth.email }}</li>
</ul>


<h2>Local Profile</h2>
{% if request.query_params.get('e') == 'csrf' %}
<p class="error">CSRF validation failed. Please try again.</p>
{% elif request.query_params.get('s') %}
<p class="success">Profile updated.</p>
{% endif %}


<form method="post" action="/profile/update">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
    <label>First name
        <input type="text" name="first_name" value="{{ db_user.first_name if db_user else '' }}" maxlength="100"
            required />
    </label>
    <label>Last name
        <input type="text" name="last_name" value="{{ db_user.last_name if db_user else '' }}" maxlength="100"
            required />
    </label>
    <label>Age
        <input type="number" name="age" value="{{ db_user.age if db_user and db_user.age is not none else '' }}" min="0"
            max="150" />
    </label>
    <button type="submit">Save</button>
</form>


<details>
    <summary>Raw DB row (for debugging)</summary>
    <pre>{{ db_user | tojson(indent=2) }}</pre>
</details>
{% endblock %}
